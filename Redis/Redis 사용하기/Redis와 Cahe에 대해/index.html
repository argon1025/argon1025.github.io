<!DOCTYPE html>
<html>
<!-- Header -->
<head>
    
    
    
    
    

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Argon.Blog - Redis와 캐싱에 대해">
    <meta property="og:description" content="Redis로 NestJS에서 Database Cahe 적용하기">
    <meta property="og:image" content="/feed-thumbnail/object29.jpg">
    <meta property="og:url" content="https://argon1025.github.io/Redis/Redis 사용하기/Redis와 Cahe에 대해/">
    <meta property="og:site_name" content="Argon.Blog - Redis와 캐싱에 대해">
    <!-- Open Graph End -->

    <!-- Title -->
    <title>Argon.Blog - Redis와 캐싱에 대해</title>
    <!-- Title End -->

    <!-- MetaData -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="Argon.Blog - Redis와 캐싱에 대해">
    <link rel="canonical" href="https://argon1025.github.io/Redis/Redis 사용하기/Redis와 Cahe에 대해/">
    <meta name="keywords" content="developer, NodeJS, NestJS" />
    <meta name="author" content="argon1025" />
    <meta name="description" content="Redis로 NestJS에서 Database Cahe 적용하기" />
    <!-- MetaData End -->

    
        <link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous">
    

    
        <!-- Favicon -->
        <link rel="icon" href="/shape.svg">
        <link rel="shortcut icon" href="/shape.svg" />
        <link rel="apple-touch-icon" sizes="72x72" href="/shape.svg" />
        <link rel="apple-touch-icon" sizes="114x114"  href="/shape.svg" />
        <link rel="apple-touch-icon" sizes="144x144"  href="/shape.svg" />
        <!-- Favicon End  -->
    

    <!-- Font -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.6/dist/web/static/pretendard.css" />
    <!-- Font End -->

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
        theme: {
            extend: {
            fontFamily: {
                'sans': ['Pretendard Variable', 'Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"],
            }
            }
        }
        }
    </script>
    <!-- TailwindCSS End -->

    <!-- highlight.js Theme -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <!-- highlight.js Theme End -->
<meta name="generator" content="Hexo 6.3.0"></head>
  <!-- Header End -->

  <body class="w-full h-full font-sans">
    <!-- Navigation -->
    <div>
      <div class="z-50 flex justify-center items-center w-full p-5 backdrop-blur-sm bg-white/60">
    <div class="flex flex-col w-full max-w-5xl justify-center items-center space-y-4 md:space-y-0 md:flex-row">
        <!-- Logo -->
        
            
                <a href="/">
                    <img src="/images/wind.png" alt="Argon.Blog" class="h-8">
                </a>
            
        
        <!-- Logo End -->
        
        <!-- Space -->
        <div class="flex grow"></div>
        <!-- Space End -->

        <!-- Menu -->
        <ul class="flex flex-row space-x-10">
        
            <li class="font-semibold hover:text-gray-400 transition duration-300 ease-in-out" data-path="/">
                <a href="/">Index</a>
            </li>
        
            <li class="font-semibold hover:text-gray-400 transition duration-300 ease-in-out" data-path="https://github.com/argon1025">
                <a target="_blank" rel="noopener" href="https://github.com/argon1025">GitHub</a>
            </li>
        
        </ul>
        <!-- Menu End -->
    </div>
</div>
    </div>
    <!-- Navigation End -->
    <!-- PostDetail -->
    <div class="flex flex-col w-full justify-center items-center space-y-5 p-5">
    <!-- Post Detail Header -->
    <div class="w-full max-w-5xl space-y-3">
      
      
      
      
      
      
      
      
      
      <!-- Header Category -->
      <div class="flex text-xs">
        <div class="flex flex-row rounded-md justify-center items-center space-x-1">
          <div class="w-3 h-3 fill-gray-400"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-full h-full"><title>Redis</title><path d="M10.5 2.661l.54.997-1.797.644 2.409.218.748 1.246.467-1.121 2.077-.208-1.61-.613.426-1.017-1.578.519zm6.905 2.077L13.76 6.182l3.292 1.298.353-.146 3.293-1.298zm-10.51.312a2.97 1.153 0 0 0-2.97 1.152 2.97 1.153 0 0 0 2.97 1.153 2.97 1.153 0 0 0 2.97-1.153 2.97 1.153 0 0 0-2.97-1.152zM24 6.805s-8.983 4.278-10.395 4.953c-1.226.561-1.901.561-3.261.094C8.318 11.022 0 7.241 0 7.241v1.038c0 .24.332.499.966.8 1.277.613 8.34 3.677 9.45 4.206 1.112.53 1.9.54 3.313-.197 1.412-.738 8.049-3.905 9.326-4.57.654-.342.945-.602.945-.84zm-10.042.602L8.39 8.26l3.884 1.61zM24 10.637s-8.983 4.279-10.395 4.954c-1.226.56-1.901.56-3.261.093C8.318 14.854 0 11.074 0 11.074v1.038c0 .238.332.498.966.8 1.277.612 8.34 3.676 9.45 4.205 1.112.53 1.9.54 3.313-.197 1.412-.737 8.049-3.905 9.326-4.57.654-.332.945-.602.945-.84zm0 3.842l-10.395 4.954c-1.226.56-1.901.56-3.261.094C8.318 18.696 0 14.916 0 14.916v1.038c0 .239.332.499.966.8 1.277.613 8.34 3.676 9.45 4.206 1.112.53 1.9.54 3.313-.198 1.412-.737 8.049-3.904 9.326-4.569.654-.343.945-.613.945-.841z"/></svg></div>
              <span class="text-gray-400">Redis 사용하기</span>
        </div>
      </div>
      <!-- Header Category End -->
      <div class="w-full flex flex-col justify-start">
        <h1 class="text-2xl md:text-4xl font-semibold mb-2">Redis와 캐싱에 대해</h1>
        <h2 class="text-sm md:text-xl text-gray-800">Redis로 NestJS에서 Database Cahe 적용하기</h2>
      </div>
      <!-- Header Tags And CreatedAt -->
      <div class="flex flex-row text-xs items-center">
        <div class="flex flex-row space-x-1">
          
            <p class="text-[#53C1F8]">#NestJS</p>
            
            <p class="text-[#53C1F8]">#Redis</p>
            
            <p class="text-[#53C1F8]">#Cache</p>
            
        </div>
        <div class="text-gray-400 ml-auto">2022년 01월 02일</div>
      </div>
      <!-- Header Tags And CreatedAt End -->
    </div>
    <!-- Post Detail Header End -->
    <!-- Thumbnail -->
    <!-- 썸네일 기능 비활성화
    <div class="w-full max-w-5xl">
      <div class="flex flex-col justify-center items-center rounded-3xl overflow-hidden h-80 w-full hover:drop-shadow-xl transition duration-300 ease-in-out">
        <img src=/feed-thumbnail/object16.jpg alt="Thumbnail" class="w-full h-full object-cover" loading="lazy"></img>
      </div>
    </div>
    -->
    <!-- Thumbnail End -->
    <!-- Content -->
    <div class="flex flex-row w-full max-w-5xl justify-center space-x-2 pt-5">
      <!-- Post Content -->
        <article class="w-full max-w-3xl prose prose-sm md:prose-base overflow-hidden text-gray-700 prose-hr:my-3 prose-pre:bg-gray-900 prose-h1:text-2xl md:prose-h1:text-3xl prose-h1:font-medium prose-h1:mt-8 prose-h1:mb-1 prose-h2:text-xl md:prose-h2:text-2xl prose-h2:font-medium prose-h2:mt-8 prose-h2:mb-1 prose-h3:text-base md:prose-h2:text-xl prose-h3:font-medium prose-h3:mt-8 prose-h3:mb-1">
          <p>프로젝트에서 레디스는 session, rateLimit 스토리지로 이미 사용하고 있지만<br>최근 게시글 랭킹 시스템을 개선하기 위해서 조금 더 깊이 레디스를 알 필요가 있다고 생각했고<br>Redis를 활용한 데이터베이스 캐싱을 적용한 과정을 공유하고자 합니다</p>
<h1 id="Redis-란"><a href="#Redis-란" class="headerlink" title="Redis 란"></a>Redis 란</h1><hr>
<p><code>In-Memory Data Structure Store</code></p>
<p>데이터베이스, 캐시, 메시지 브로커로 사용되는 인 메모리 데이터 구조 저장소입니다</p>
<h1 id="지원하는-데이터-자료구조-Collection"><a href="#지원하는-데이터-자료구조-Collection" class="headerlink" title="지원하는 데이터 자료구조(Collection)"></a>지원하는 데이터 자료구조(Collection)</h1><hr>
<p>Redis는 Mem cached와 다르게 여러 가지 데이터 자료구조를 지원합니다.<br>간단하게 주로 사용되는 것들을 나열해 보겠습니다</p>
<h2 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h2><p>일반적인 Key-value입니다.<br>문자열뿐만 아니라 모든 종류의 데이터를 저장할 수 있습니다<br>Key에 할당 가능한 데이터의 크기는 512mb입니다</p>
<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><p>String의 집합으로 새로운 요소를 <code>앞, 뒤</code>로 삽입하는것이 매우 빠릅니다</p>
<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p><img src="https://user-images.githubusercontent.com/55491354/193414646-71399e51-d46f-4e11-82e2-d25155114f2d.png" alt="image"><br>List와 다르게 중복된 데이터를 넣을 수 없는 string 집합입니다<br>SET 자료구조 간 <code>집합 연산</code>을 매우 빠른시간내에 처리 할 수 있습니다</p>
<h2 id="Sorted-set"><a href="#Sorted-set" class="headerlink" title="Sorted-set"></a>Sorted-set</h2><p><img src="https://user-images.githubusercontent.com/55491354/193414674-3d017366-1c56-45b3-a7fc-57c81359fc56.png" alt="image"><br>Set 자료구조의 특성은 그대로 가지면서 추가로 <code>score</code>를 저장해서<br>저장된 값들의 순서를 관리합니다<br>Score가 같다면 사전 순으로 정렬됩니다</p>
<h2 id="Hashes"><a href="#Hashes" class="headerlink" title="Hashes"></a>Hashes</h2><p><img src="https://user-images.githubusercontent.com/55491354/193414703-947ae300-7c5f-4e10-b40c-a2a9564c51f8.png" alt="image"><br>데이터베이스와 유사하게 하나의 <code>key</code>에 여러 개의 서브키, 데이터를 저장할 수 있습니다</p>
<h2 id="Hyperloglog"><a href="#Hyperloglog" class="headerlink" title="Hyperloglog"></a>Hyperloglog</h2><p>해당 집합 내 원소의 개수를 추정하는 방법입니다<br>매우 큰 집합의 근사치 카운트를 구할 때 사용합니다(1% 미만 오차)</p>
<h2 id="Bitmap"><a href="#Bitmap" class="headerlink" title="Bitmap"></a>Bitmap</h2><p>0, 1 상태를 가지는 Key들을 효율적으로 관리할 수 있습니다</p>
<h2 id="Geospatial"><a href="#Geospatial" class="headerlink" title="Geospatial"></a>Geospatial</h2><p><img src="https://user-images.githubusercontent.com/55491354/193414751-e1a195c2-52ec-48d7-9532-9a4f893e0f23.png" alt="image"><br>경도와 위도를 저장합니다</p>
<blockquote>
<p>추가적으로 사용가능한 명령어는</p>
<p><a target="_blank" rel="noopener" href="https://redis.io/commands">https://redis.io/commands</a> 공식문서에서 확인할 수 있었습니다.</p>
</blockquote>
<h1 id="Cache가-해결하는-문제"><a href="#Cache가-해결하는-문제" class="headerlink" title="Cache가 해결하는 문제"></a>Cache가 해결하는 문제</h1><hr>
<p>캐시는 고속 데이터 스토리지 계층으로<br>A 데이터를 캐시 스토리지에 저장한 뒤 이후에 A 데이터에 대한 요청이 있으면<br>데이터의 기본 스토리지에 엑세스 하는 것 보다 더 <code>빠르게</code> 요청을 처리할 수 있습니다<br>하지만 캐시로 저장된 데이터는 <code>실시간 업데이트가 불가능</code>하기 때문에<br>실시간 변경이 필요하지 않고<br>데이터를 새로 고침하는 주기가 일정한(랭킹, 연산 결과의 저장(팩토리얼)) 환경에서 주로 사용합니다</p>
<h1 id="Cache-적용-패턴"><a href="#Cache-적용-패턴" class="headerlink" title="Cache 적용 패턴"></a>Cache 적용 패턴</h1><hr>
<h2 id="Inline-Cache"><a href="#Inline-Cache" class="headerlink" title="Inline Cache"></a>Inline Cache</h2><p><img src="https://user-images.githubusercontent.com/55491354/193414978-6f5484b4-fbcd-4c01-a560-f9b69eff171c.png" alt="image"><br>데이터를 조회할 때 반드시 캐시에서 조회하고<br>일정 주기로 시작되는 배치 작업이 캐시 스토리지를 업데이트하는 방식입니다</p>
<h3 id="고려사항"><a href="#고려사항" class="headerlink" title="고려사항"></a>고려사항</h3><ul>
<li>모든 데이터를 캐시 스토리지에 적재합니다</li>
<li>추가적인 배치 작업 설계가 필요합니다</li>
<li>배치작업이 원활하게 이루어지지 않을 경우 캐시 스토리지와 데이터베이스 간 정합성이 크게 깨집니다</li>
</ul>
<h2 id="Cache-Aside-Look-aside-Cache"><a href="#Cache-Aside-Look-aside-Cache" class="headerlink" title="Cache Aside (Look aside Cache)"></a>Cache Aside (Look aside Cache)</h2><p><img src="https://user-images.githubusercontent.com/55491354/193415015-eefca746-b6b7-4970-84c9-cc779567d2b3.png" alt="image"><br>일반적으로 가장 많이 사용되는 패턴입니다<br>데이터를 조회할 때 캐시에서 조회한 뒤 데이터가 있다면 바로 응답하고<br>없다면 데이터베이스에서 데이터를 조회한 뒤 데이터를 캐시 스토리지에 저장한 뒤 응답하는 방식입니다.</p>
<h3 id="고려사항-1"><a href="#고려사항-1" class="headerlink" title="고려사항"></a>고려사항</h3><ul>
<li>최초접근 또는 캐시 데이터가 만료되었을 경우 데이터베이스에 접근합니다</li>
</ul>
<h2 id="Write-back"><a href="#Write-back" class="headerlink" title="Write back"></a>Write back</h2><p><img src="https://user-images.githubusercontent.com/55491354/193415105-edcfc6e6-8834-4f76-a956-7f912ba6e7d1.png" alt="image"><br>데이터를 조회, 수정할 때 모든 상호작용을 캐시 스토리지에서 진행합니다<br>일정 주기마다 캐시 스토리지에 있는 데이터를 데이터베이스에 저장합니다</p>
<h3 id="추가사항"><a href="#추가사항" class="headerlink" title="추가사항"></a>추가사항</h3><p>INSERT를 따로 N회 하는 것 보다<br>N개의 데이터를 한꺼번에 INSERT 하는 것이 퍼포먼스가 좋다는 검증 결과에 근거한 방식입니다</p>
<h3 id="고려사항-2"><a href="#고려사항-2" class="headerlink" title="고려사항"></a>고려사항</h3><ul>
<li>캐시 스토리지가 다운되면 저장되지 않은 데이터는 모두 사라집니다</li>
<li>캐시 스토리지가 다운된 후 다시 서비스를 시작하기 위해서 추가 작업이 필요합니다</li>
</ul>
<h1 id="레디스도-동시성-문제가-발생할-수-있다"><a href="#레디스도-동시성-문제가-발생할-수-있다" class="headerlink" title="레디스도 동시성 문제가 발생할 수 있다"></a>레디스도 동시성 문제가 발생할 수 있다</h1><hr>
<p>레디스는 단일 스레드이고 단일 명령을 실행할 때는 원자성을 보장하지만<br>여러 클라이언트가 동일한 데이터를 상대로 명령을 실행 할 경우<br>일반적인 RDBMS와 마찬가지로 <strong>갱신손실</strong>이 발생할 수 있습니다<br>트랜잭션을 사용해서 데이터의 고립성을 지켜야 합니다</p>
<blockquote>
<p>레디스에서 잠금, 트랜잭션이 필요한 이유 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/30004364/redis-race-condition-and-single-threaded">스택 오버 플로우 링크</a></p>
</blockquote>
<blockquote>
<p>레디스 트랜잭션 공식 문서 <a target="_blank" rel="noopener" href="https://redis.io/topics/transactions">https://redis.io/topics/transactions</a></p>
</blockquote>
<h1 id="NestJS에서-캐싱-적용하기"><a href="#NestJS에서-캐싱-적용하기" class="headerlink" title="NestJS에서 캐싱 적용하기"></a>NestJS에서 캐싱 적용하기</h1><hr>
<p>위 사항들을 모두 숙지한 상태에서 NestJS를 통해 캐싱을 구현해보도록 하겠습니다</p>
<p>NestJS경우 여러 가지 캐시 저장소(Redis, Memcache, In-Memory)를 지원하고<br>각 기능을 추상화 래핑 하는 <code>cache-manager</code> 모듈이 존재합니다<br>이 모듈은 다양한 캐시 저장소에 대해 통합된 추상화 인터페이스(퍼사드 패턴, 어댑터 패턴)로 제공하기때문에<br>도중에 스토리지를 변경하더라도 쉽게 대응할 수 있습니다</p>
<p>하지만 각 캐시 저장소의 세부 기능을 이용할 수 없는 단점이 있습니다<br>진행하는 프로젝트에서 해당 모듈이 제공하는 기능이 부족함이 없기 때문에 그대로 적용해 보겠습니다.</p>
<h2 id="CacheManager-Module"><a href="#CacheManager-Module" class="headerlink" title="CacheManager.Module"></a>CacheManager.Module</h2><pre><code class="hljs typescript">...
<span class="hljs-meta">@Module</span>(&#123;
  <span class="hljs-attr">imports</span>: [
<span class="hljs-title class_">CacheModule</span>.<span class="hljs-title function_">registerAsync</span>(&#123;
      <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ConfigModule</span>],
      <span class="hljs-attr">inject</span>: [<span class="hljs-title class_">ConfigService</span>],
      <span class="hljs-attr">useFactory</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">configService</span>: <span class="hljs-title class_">ConfigService</span>) =&gt; &#123;
        <span class="hljs-comment">// Redis config</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REDIS_HOST</span> = configService.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&#x27;REDIS_HOST&#x27;</span>, <span class="hljs-string">&#x27;localhost&#x27;</span>);
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REDIS_PORT</span> = configService.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">&#x27;REDIS_PORT&#x27;</span>, <span class="hljs-number">6379</span>);
        <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">store</span>: redisStore, <span class="hljs-attr">host</span>: <span class="hljs-variable constant_">REDIS_HOST</span>, <span class="hljs-attr">port</span>: <span class="hljs-variable constant_">REDIS_PORT</span> &#125;;
      &#125;,
    &#125;),

...
<span class="hljs-attr">export</span>:[<span class="hljs-title class_">CacheManagerService</span>]</code></pre>

<p><code>ConfigModule</code> 을 사용하기 위해 registerAsync로 환경변수를 가져왔습니다<br>이후 다른 모듈에서 서비스를 사용하기 위해 <code>CacheManagerService</code>를 export합니다</p>
<h2 id="CacheManager-Service"><a href="#CacheManager-Service" class="headerlink" title="CacheManager.Service"></a>CacheManager.Service</h2><pre><code class="hljs tsx"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheManagerService</span> &#123;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-meta">@Inject</span>(CACHE_MANAGER) <span class="hljs-keyword">private</span> cacheManager: Cache</span>) &#123;&#125;

  <span class="hljs-comment">/**</span>
<span class="hljs-comment">   * 트랜드 포스트 데이터를 캐시에 저장합니다</span>
<span class="hljs-comment">   * <span class="hljs-doctag">@param</span> requestData:&#123; ScopeData: searchScope; cursor: number; postListData: MostLikedResponseDto; ttl: number &#125;</span>
<span class="hljs-comment">   * <span class="hljs-doctag">@returns</span></span>
<span class="hljs-comment">   */</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setTrendPost</span>(<span class="hljs-params">requestData: &#123;</span>
<span class="hljs-params">    ScopeData: searchScope;</span>
<span class="hljs-params">    cursor: <span class="hljs-built_in">number</span>;</span>
<span class="hljs-params">    postListData: MostLikedResponseDto;</span>
<span class="hljs-params">    ttl: <span class="hljs-built_in">number</span>;</span>
<span class="hljs-params">  &#125;</span>) &#123;
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">KEY_NAME</span> = <span class="hljs-string">`TrendPost<span class="hljs-subst">$&#123;requestData.ScopeData&#125;</span>:<span class="hljs-subst">$&#123;requestData.cursor&#125;</span>`</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable constant_">KEY_NAME</span>, requestData.<span class="hljs-property">postListData</span>, &#123; <span class="hljs-attr">ttl</span>: requestData.<span class="hljs-property">ttl</span> &#125;);
  &#125;

  <span class="hljs-comment">/**</span>
<span class="hljs-comment">   * 캐시에 저장된 트랜드 포스트 데이터를 조회합니다</span>
<span class="hljs-comment">   * <span class="hljs-doctag">@param</span> requestData:&#123; ScopeData: searchScope; cursor: number &#125;</span>
<span class="hljs-comment">   * <span class="hljs-doctag">@returns</span></span>
<span class="hljs-comment">   */</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getTrendPost</span>(<span class="hljs-params">requestData: &#123; ScopeData: searchScope; cursor: <span class="hljs-built_in">number</span> &#125;</span>) &#123;
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">KEY_NAME</span> = <span class="hljs-string">`TrendPost<span class="hljs-subst">$&#123;requestData.ScopeData&#125;</span>:<span class="hljs-subst">$&#123;requestData.cursor&#125;</span>`</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheManager</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">KEY_NAME</span>);
  &#125;
&#125;</code></pre>

<p>각 서비스에서 필요한 형태대로 서비스 메서드를 작성합니다<br>위 예제에서는 인기 게시글 조회 결과 전체를 캐시 매니저를 통해 저장하고 가져오는 서비스 메서드를 구현했습니다</p>
<h2 id="Post-Controller-에-위-캐시-매니저-서비스-적용"><a href="#Post-Controller-에-위-캐시-매니저-서비스-적용" class="headerlink" title="Post.Controller 에 위 캐시 매니저 서비스 적용"></a>Post.Controller 에 위 캐시 매니저 서비스 적용</h2><pre><code class="hljs typescript">...
<span class="hljs-keyword">const</span> cacheResult = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">CacheManagerService</span>.<span class="hljs-title function_">getTrendPost</span>(&#123; <span class="hljs-title class_">ScopeData</span>: searchScopeData, <span class="hljs-attr">cursor</span>: cursor &#125;);

      <span class="hljs-keyword">if</span> (!!cacheResult) &#123;
        <span class="hljs-comment">// 캐시가 존재할 경우</span>
        <span class="hljs-comment">// 응답 리턴</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseUtility</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;ok&#x27;</span>, cacheResult);
      &#125; <span class="hljs-keyword">else</span> &#123;

        <span class="hljs-comment">// 캐시가 없을 경우 데이터 베이스에 질의</span>
        <span class="hljs-keyword">const</span> getPostsResult = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">postsService</span>.<span class="hljs-title function_">getMostLiked</span>(getPostsRequestDto);

        <span class="hljs-comment">// 캐시 저장</span>
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">CacheManagerService</span>.<span class="hljs-title function_">setTrendPost</span>(&#123; <span class="hljs-title class_">ScopeData</span>: searchScopeData, <span class="hljs-attr">cursor</span>: cursor, <span class="hljs-attr">postListData</span>: getPostsResult, <span class="hljs-attr">ttl</span>: <span class="hljs-number">5000</span> &#125;);

        <span class="hljs-comment">// 응답 리턴</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseUtility</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;ok&#x27;</span>, getPostsResult);
...</code></pre>

<p><code>CacheManager.Service</code>를 Post 트랜드 리스트를 보여주는 서비스 로직에 적용 했습니다</p>
<h1 id="적용-결과"><a href="#적용-결과" class="headerlink" title="적용 결과"></a>적용 결과</h1><hr>
<p><img src="https://user-images.githubusercontent.com/55491354/193415324-86fbb025-859e-48f7-962c-0e2f8dc9d694.png" alt="image"></p>
<p>데이터베이스에 직접 액세스하는 첫번째 요청보다 더 빠르게 사용자에게 데이터를 제공할 수 있었습니다</p>
<h1 id="더-읽어보면-좋은-글"><a href="#더-읽어보면-좋은-글" class="headerlink" title="더 읽어보면 좋은 글"></a>더 읽어보면 좋은 글</h1><hr>
<p>글을 작성하면서 추가로 리서치한 페이지들 입니다</p>
<p><code>Reids Persistence</code><br>레디스는 인메모리 스토리지지만 데이터 스냅샷을 저장해서 불러오는 영속성 옵션을 제공합니다<br><a target="_blank" rel="noopener" href="https://redis.io/topics/persistence">https://redis.io/topics/persistence</a></p>
<p><code>Redis Cluster</code><br>레디스는 고가용성을 위한 클러스터링, 샤딩 기능을 제공합니다<br><a target="_blank" rel="noopener" href="https://redis.io/topics/cluster-tutorial">https://redis.io/topics/cluster-tutorial</a></p>
<p><code>Redis Pub/Sub</code><br>Publish로 메시지를 보내고 Subscribe으로 메시지를 받는형태의 메시징 페러다임을 구현할 수 있습니다<br><a target="_blank" rel="noopener" href="https://redis.io/topics/pubsub">https://redis.io/topics/pubsub</a></p>
<p><code>Redis Stream</code><br>Kafka와 유사항 메시징 큐 시스템을 구현할 수 있습니다<br>Pub&#x2F;Sub와 달리 소비자의 개념이 있고 하나의 메시지가 여러 소비자에게 전달되지 않습니다<br><a target="_blank" rel="noopener" href="https://redis.io/topics/streams-intro">https://redis.io/topics/streams-intro</a></p>
<p>NestJS에서는 대표적으로 두가지의 Redis Client 모듈이 존재합니다<br>지금 포스트에서는 공식 Node-Redis 모듈을 사용하지만 아래와 같은 문제점이 있을 가능성이 높습니다<br><a target="_blank" rel="noopener" href="https://ably.com/blog/migrating-from-node-redis-to-ioredis">https://ably.com/blog/migrating-from-node-redis-to-ioredis</a></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><hr>
<p>우아한 레디스<br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=mPB2CZiAkKM&t=1364s">https://www.youtube.com/watch?v=mPB2CZiAkKM&t=1364s</a></p>
<p>레디스 카프카 레빗엠큐 차이점에 대해<br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=H_DaPyUOeTo">https://www.youtube.com/watch?v=H_DaPyUOeTo</a></p>
<p>캐시 정책에 대해<br><a target="_blank" rel="noopener" href="https://sowhat4.tistory.com/64">https://sowhat4.tistory.com/64</a><br><a target="_blank" rel="noopener" href="https://brunch.co.kr/@springboot/151">https:&#x2F;&#x2F;brunch.co.kr&#x2F;@springboot&#x2F;151</a></p>
<p>NestJS CacheModule연동<br><a target="_blank" rel="noopener" href="https://medium.com/zigbang/nestjs%EC%9D%98-module%EA%B3%BC-cachemodule%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%9C-redis-%EC%97%B0%EB%8F%99-2166a771196">https://medium.com/zigbang/nestjs의-module과-cachemodule을-활용한-redis-연동-2166a771196</a></p>

        </article>
        <!-- Post Content End -->
    </div>
    <!-- Content End -->
</div>
    <!-- PostDetail End -->
    
<footer class="flex flex-col w-full justify-center items-center mt-28 py-16 px-5 bg-gray-50">
    <div class="flex flex-col w-full max-w-5xl space-y-1">
        <div class="flex flex-row text-sm font-semibold text-gray-400 items-center space-x-1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25" />
              </svg>              
              <span class="">Created By Argon1025 (argon1025@gmail.com)</span>
        </div>
        <div class="flex flex-row text-sm text-gray-400 items-center space-x-1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
              </svg>
              <span class="">Special thanks | Feed Thumbnail By Milad Fakurian</span>
        </div>
    </div>
</footer>
  </body>
</html>